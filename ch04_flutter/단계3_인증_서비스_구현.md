# ë‹¨ê³„ 3: ì¸ì¦ ì„œë¹„ìŠ¤ êµ¬í˜„

## ğŸ¯ ëª©í‘œ
ë¡œê·¸ì¸, íšŒì›ê°€ì…, ë¡œê·¸ì•„ì›ƒ ë“± ì¸ì¦ ê´€ë ¨ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## ğŸ“ ì‘ì—… ë‚´ìš©

### 3.1 AuthService í´ë˜ìŠ¤ ìƒì„±

`lib/services/auth_service.dart` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

```dart
import 'package:dio/dio.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'api_service.dart';

class AuthService {
  final ApiService _apiService = ApiService();
  
  // SharedPreferencesì— ì €ì¥í•  í‚¤ ì´ë¦„
  static const String _isLoggedInKey = 'is_logged_in';
  static const String _usernameKey = 'username';

  // íšŒì›ê°€ì…
  Future<Map<String, dynamic>> join({
    required String username,
    required String password,
  }) async {
    try {
      final response = await _apiService.dio.post(
        '/join',
        data: {
          'username': username,
          'password': password,
        },
      );

      if (response.statusCode == 200) {
        return {'success': true, 'message': 'íšŒì›ê°€ì… ì„±ê³µ'};
      }
      return {'success': false, 'message': 'íšŒì›ê°€ì… ì‹¤íŒ¨'};
    } on DioException catch (e) {
      return {
        'success': false,
        'message': e.response?.data['message'] ?? 'íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ ë°œìƒ'
      };
    }
  }

  // ë¡œê·¸ì¸
  Future<Map<String, dynamic>> login({
    required String username,
    required String password,
  }) async {
    try {
      final response = await _apiService.dio.post(
        '/login',
        data: {
          'username': username,
          'password': password,
        },
      );

      if (response.statusCode == 200) {
        // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë¡œì»¬ ì €ì¥ì†Œì— ìƒíƒœ ì €ì¥
        final prefs = await SharedPreferences.getInstance();
        await prefs.setBool(_isLoggedInKey, true);
        await prefs.setString(_usernameKey, username);

        return {
          'success': true,
          'message': response.data['message'] ?? 'ë¡œê·¸ì¸ ì„±ê³µ',
        };
      }
      return {'success': false, 'message': 'ë¡œê·¸ì¸ ì‹¤íŒ¨'};
    } on DioException catch (e) {
      return {
        'success': false,
        'message': e.response?.data['message'] ?? 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ'
      };
    }
  }

  // ë¡œê·¸ì•„ì›ƒ
  Future<void> logout() async {
    try {
      // ë°±ì—”ë“œì— ë¡œê·¸ì•„ì›ƒ ìš”ì²­
      await _apiService.dio.post('/logout');
    } catch (e) {
      // ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨í•´ë„ ë¡œì»¬ ìƒíƒœëŠ” ì‚­ì œ
    } finally {
      // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œ
      final prefs = await SharedPreferences.getInstance();
      await prefs.remove(_isLoggedInKey);
      await prefs.remove(_usernameKey);
    }
  }

  // í† í° ìœ íš¨ì„± ê²€ì¦
  Future<bool> validateToken() async {
    try {
      final response = await _apiService.dio.get('/validate');
      return response.statusCode == 200;
    } catch (e) {
      return false;
    }
  }

  // ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
  Future<Map<String, dynamic>?> getUserInfo() async {
    try {
      final response = await _apiService.dio.get('/user');
      if (response.statusCode == 200) {
        return response.data;
      }
      return null;
    } catch (e) {
      return null;
    }
  }

  // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
  Future<bool> isLoggedIn() async {
    final prefs = await SharedPreferences.getInstance();
    return prefs.getBool(_isLoggedInKey) ?? false;
  }

  // ì €ì¥ëœ ì‚¬ìš©ìëª… ê°€ì ¸ì˜¤ê¸°
  Future<String?> getUsername() async {
    final prefs = await SharedPreferences.getInstance();
    return prefs.getString(_usernameKey);
  }
}
```

## ğŸ“– ë©”ì„œë“œ ì„¤ëª…

### 1. join() - íšŒì›ê°€ì…
- **ê¸°ëŠ¥**: ìƒˆë¡œìš´ ì‚¬ìš©ì ê³„ì • ìƒì„±
- **íŒŒë¼ë¯¸í„°**: username, password
- **ë°˜í™˜**: ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ë©”ì‹œì§€

### 2. login() - ë¡œê·¸ì¸
- **ê¸°ëŠ¥**: ì‚¬ìš©ì ì¸ì¦ ë° í† í° ë°œê¸‰
- **íŒŒë¼ë¯¸í„°**: username, password
- **ë™ì‘**:
  1. ë°±ì—”ë“œì— ë¡œê·¸ì¸ ìš”ì²­
  2. ì„±ê³µ ì‹œ ì¿ í‚¤ì— JWT í† í° ì €ì¥ (ìë™)
  3. ë¡œì»¬ ì €ì¥ì†Œì— ë¡œê·¸ì¸ ìƒíƒœ ì €ì¥
- **ë°˜í™˜**: ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ë©”ì‹œì§€

### 3. logout() - ë¡œê·¸ì•„ì›ƒ
- **ê¸°ëŠ¥**: ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
- **ë™ì‘**:
  1. ë°±ì—”ë“œì— ë¡œê·¸ì•„ì›ƒ ìš”ì²­
  2. ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œ

### 4. validateToken() - í† í° ê²€ì¦
- **ê¸°ëŠ¥**: í˜„ì¬ í† í°ì´ ìœ íš¨í•œì§€ í™•ì¸
- **ë°˜í™˜**: ìœ íš¨ ì—¬ë¶€ (true/false)

### 5. getUserInfo() - ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
- **ê¸°ëŠ¥**: í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
- **ë°˜í™˜**: ì‚¬ìš©ì ì •ë³´ (username, role) ë˜ëŠ” null

### 6. isLoggedIn() - ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
- **ê¸°ëŠ¥**: ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
- **ë°˜í™˜**: ë¡œê·¸ì¸ ì—¬ë¶€ (true/false)

### 7. getUsername() - ì‚¬ìš©ìëª… ê°€ì ¸ì˜¤ê¸°
- **ê¸°ëŠ¥**: ì €ì¥ëœ ì‚¬ìš©ìëª… ê°€ì ¸ì˜¤ê¸°
- **ë°˜í™˜**: ì‚¬ìš©ìëª… ë˜ëŠ” null

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### SharedPreferences ì‚¬ìš© ì´ìœ 
- ë¡œê·¸ì¸ ìƒíƒœë§Œ ì €ì¥ (í† í°ì€ ì¿ í‚¤ì— ì €ì¥)
- ì•± ì¬ì‹œì‘ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ìš©
- ì‹¤ì œ ì¸ì¦ì€ ì„œë²„ì˜ JWT í† í°ìœ¼ë¡œ ì²˜ë¦¬

### ì—ëŸ¬ ì²˜ë¦¬
- `DioException`: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬
- `try-catch`: ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬
- ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ

## âœ… í™•ì¸ ì‚¬í•­
- [ ] `lib/services/auth_service.dart` íŒŒì¼ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] ëª¨ë“  ë©”ì„œë“œê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] ì½”ë“œì— ë¬¸ë²• ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸

## ğŸ” ë¬¸ì œ í•´ê²°

### API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ
- ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
- CORS ì„¤ì • í™•ì¸

### ì¿ í‚¤ê°€ ì €ì¥ë˜ì§€ ì•ŠëŠ” ê²½ìš°
- `ApiService`ì˜ `CookieManager` í™•ì¸
- ë°±ì—”ë“œ CORS ì„¤ì • í™•ì¸

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„
ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” ë¡œê·¸ì¸ í™”ë©´ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
â†’ [ë‹¨ê³„4: ë¡œê·¸ì¸ í™”ë©´ êµ¬í˜„](./ë‹¨ê³„4_ë¡œê·¸ì¸_í™”ë©´_êµ¬í˜„.md)

