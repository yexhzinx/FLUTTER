# 단계 8: 테스트 및 확인

## 🎯 목표
구현한 앱이 정상적으로 작동하는지 테스트하고 확인합니다.

## 📝 테스트 절차

### 8.1 백엔드 서버 확인

1. **백엔드 서버 실행 확인**
   - ch04_BN 프로젝트 실행
   - 포트 8090에서 서버가 실행 중인지 확인

2. **데이터베이스 확인**
   - MySQL이 실행 중인지 확인
   - 데이터베이스 연결 확인

3. **Redis 확인**
   - Redis 서버가 실행 중인지 확인
   - 포트 6379에서 실행 중인지 확인

4. **API 엔드포인트 테스트**
   - 브라우저에서 `http://localhost:8090/validate` 접속
   - 정상 응답 확인 (401 또는 200)

### 8.2 앱 실행

터미널에서 다음 명령어를 실행합니다:

```bash
cd ch04_flutter
flutter pub get
flutter run
```

### 8.3 회원가입 테스트

1. **회원가입 화면 이동**
   - 앱 실행 후 로그인 화면에서 "회원가입" 버튼 클릭

2. **회원가입 정보 입력**
   - 사용자명: `testuser`
   - 비밀번호: `test1234`
   - 비밀번호 확인: `test1234`

3. **회원가입 실행**
   - "회원가입" 버튼 클릭
   - 성공 메시지 확인
   - 로그인 화면으로 자동 이동 확인

4. **에러 케이스 테스트**
   - 비밀번호 불일치 시 에러 메시지 확인
   - 비밀번호 4자 미만 시 에러 메시지 확인

### 8.4 로그인 테스트

1. **로그인 정보 입력**
   - 회원가입한 사용자명과 비밀번호 입력
   - 사용자명: `testuser`
   - 비밀번호: `test1234`

2. **로그인 실행**
   - "로그인" 버튼 클릭
   - 로딩 인디케이터 확인
   - 홈 화면으로 이동 확인

3. **에러 케이스 테스트**
   - 잘못된 사용자명/비밀번호 입력 시 에러 메시지 확인
   - 빈 필드 제출 시 검증 메시지 확인

### 8.5 사용자 정보 확인

1. **홈 화면 확인**
   - 사용자명이 표시되는지 확인
   - 권한(ROLE_USER)이 표시되는지 확인
   - 정보가 올바르게 표시되는지 확인

2. **로딩 상태 확인**
   - 화면 로드 시 로딩 인디케이터 표시 확인
   - 정보 로드 완료 후 카드 표시 확인

### 8.6 로그아웃 테스트

1. **로그아웃 실행**
   - 홈 화면에서 로그아웃 버튼(우측 상단) 클릭
   - 로그인 화면으로 이동 확인

2. **재로그인 테스트**
   - 다시 로그인할 수 있는지 확인
   - 쿠키가 제대로 삭제되었는지 확인

### 8.7 토큰 갱신 테스트 (선택사항)

1. **토큰 만료 대기**
   - 로그인 후 30초 이상 대기 (Access Token 만료 시간)

2. **자동 갱신 확인**
   - 홈 화면에서 새로고침 또는 다른 API 호출
   - 자동으로 토큰이 갱신되어 정상 작동하는지 확인

### 8.8 앱 재시작 테스트

1. **앱 종료 후 재시작**
   - 앱을 완전히 종료
   - 앱을 다시 실행

2. **자동 로그인 확인**
   - 로그인 상태가 유지되면 홈 화면으로 자동 이동
   - 로그인 상태가 아니면 로그인 화면으로 이동

## ✅ 최종 확인 사항

### 기능 확인
- [ ] 회원가입이 정상적으로 작동하는가?
- [ ] 로그인이 정상적으로 작동하는가?
- [ ] 홈 화면에 사용자 정보가 표시되는가?
- [ ] 로그아웃이 정상적으로 작동하는가?
- [ ] 에러 메시지가 올바르게 표시되는가?
- [ ] 로딩 인디케이터가 표시되는가?

### UI/UX 확인
- [ ] 화면 전환이 부드러운가?
- [ ] 에러 메시지가 명확한가?
- [ ] 로딩 상태가 적절히 표시되는가?
- [ ] 사용자 경험이 좋은가?

### 보안 확인
- [ ] 쿠키가 제대로 저장되는가?
- [ ] 로그아웃 시 쿠키가 삭제되는가?
- [ ] 토큰이 안전하게 관리되는가?

## 🐛 문제 해결

### 문제 1: "Connection refused" 에러

**증상**: 네트워크 연결 오류

**원인**: 백엔드 서버가 실행되지 않음

**해결 방법**:
1. 백엔드 서버를 실행하고 포트 8090이 열려있는지 확인
2. `ApiService`의 `baseUrl` 확인
3. 방화벽 설정 확인

### 문제 2: 쿠키가 저장되지 않음

**증상**: 로그인 후 사용자 정보를 가져올 수 없음

**원인**: CORS 설정 문제 또는 쿠키 관리자 미설정

**해결 방법**:
1. `ApiService`에 `CookieManager`가 추가되었는지 확인
2. 백엔드의 CORS 설정 확인 (`allowCredentials: true`)
3. 도메인 및 경로 설정 확인

### 문제 3: 401 Unauthorized 에러

**증상**: 인증 오류

**원인**: 토큰이 만료되었거나 없음

**해결 방법**:
1. 다시 로그인하여 새 토큰 발급
2. 백엔드 로그 확인
3. 토큰 만료 시간 확인

### 문제 4: 화면 전환이 안 됨

**증상**: 버튼 클릭 후 화면이 전환되지 않음

**원인**: 라우트 설정 오류

**해결 방법**:
1. `main.dart`의 `routes` 설정 확인
2. 화면 이름이 정확한지 확인
3. `Navigator` 사용법 확인

### 문제 5: 사용자 정보가 표시되지 않음

**증상**: 홈 화면에 사용자 정보가 표시되지 않음

**원인**: API 호출 실패 또는 응답 파싱 오류

**해결 방법**:
1. 백엔드 서버가 실행 중인지 확인
2. 쿠키에 토큰이 포함되어 있는지 확인
3. API 응답 확인 (백엔드 로그 확인)
4. 네트워크 연결 확인

## 📊 테스트 체크리스트

### 기본 기능
- [ ] 회원가입
- [ ] 로그인
- [ ] 사용자 정보 조회
- [ ] 로그아웃

### 에러 처리
- [ ] 네트워크 오류 처리
- [ ] 인증 오류 처리
- [ ] 입력 검증 오류 처리

### 사용자 경험
- [ ] 로딩 상태 표시
- [ ] 에러 메시지 표시
- [ ] 화면 전환 애니메이션

## 🎉 완료!

축하합니다! Flutter 인증 앱을 성공적으로 구현하고 테스트했습니다.

## 📚 다음 단계

이제 다음 기능들을 추가로 구현해볼 수 있습니다:

1. **사용자 프로필 수정**
   - 사용자 정보 수정 기능
   - 비밀번호 변경 기능

2. **에러 처리 개선**
   - 더 상세한 에러 메시지
   - 네트워크 오류 처리 개선

3. **토큰 자동 갱신**
   - 토큰 만료 전 자동 갱신 로직
   - 인터셉터를 사용한 자동 처리

4. **OAuth2 소셜 로그인**
   - Google 로그인
   - Kakao 로그인
   - Naver 로그인

5. **UI/UX 개선**
   - 더 나은 디자인
   - 애니메이션 추가
   - 다크 모드 지원

## 📖 참고 자료

- [Flutter 공식 문서](https://docs.flutter.dev/)
- [Dio 패키지 문서](https://pub.dev/packages/dio)
- [SharedPreferences 문서](https://pub.dev/packages/shared_preferences)
- [Spring Security 문서](https://spring.io/projects/spring-security)

