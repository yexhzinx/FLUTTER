# 단계 7: 라우팅 설정

## 🎯 목표
앱의 라우팅을 설정하고, 앱 시작 시 로그인 상태를 확인하여 적절한 화면을 표시합니다.

## 📝 작업 내용

### 7.1 main.dart 파일 수정

`lib/main.dart` 파일을 열고 다음 코드로 교체합니다:

```dart
import 'package:flutter/material.dart';
import 'screens/login_screen.dart';
import 'screens/join_screen.dart';
import 'screens/home_screen.dart';
import 'services/auth_service.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter 인증 앱',
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
        useMaterial3: true,
      ),
      // 초기 화면을 SplashScreen으로 설정
      initialRoute: '/',
      // 라우트 설정
      routes: {
        '/': (context) => const SplashScreen(),
        '/login': (context) => const LoginScreen(),
        '/join': (context) => const JoinScreen(),
        '/home': (context) => const HomeScreen(),
      },
    );
  }
}

// 스플래시 화면 (로그인 상태 확인)
class SplashScreen extends StatefulWidget {
  const SplashScreen({super.key});

  @override
  State<SplashScreen> createState() => _SplashScreenState();
}

class _SplashScreenState extends State<SplashScreen> {
  @override
  void initState() {
    super.initState();
    // 로그인 상태 확인
    _checkLoginStatus();
  }

  // 로그인 상태 확인 함수
  Future<void> _checkLoginStatus() async {
    final authService = AuthService();
    
    // 로컬 저장소에서 로그인 상태 확인
    final isLoggedIn = await authService.isLoggedIn();
    
    // 화면이 아직 마운트되어 있는지 확인
    if (mounted) {
      if (isLoggedIn) {
        // 로그인 상태라면 토큰 유효성 검증
        final isValid = await authService.validateToken();
        if (isValid) {
          // 토큰이 유효하면 홈 화면으로 이동
          Navigator.pushReplacementNamed(context, '/home');
        } else {
          // 토큰이 무효하면 로그인 화면으로 이동
          Navigator.pushReplacementNamed(context, '/login');
        }
      } else {
        // 로그인 상태가 아니면 로그인 화면으로 이동
        Navigator.pushReplacementNamed(context, '/login');
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return const Scaffold(
      body: Center(
        child: CircularProgressIndicator(),
      ),
    );
  }
}
```

## 📖 코드 설명

### MaterialApp 설정

1. **title**: 앱 제목
2. **theme**: 앱 테마 설정
3. **initialRoute**: 앱 시작 시 표시할 화면
4. **routes**: 화면 경로 설정
   - `'/'`: 스플래시 화면
   - `'/login'`: 로그인 화면
   - `'/join'`: 회원가입 화면
   - `'/home'`: 홈 화면

### SplashScreen (스플래시 화면)

**역할**: 앱 시작 시 로그인 상태를 확인하고 적절한 화면으로 이동

**동작 과정**:
1. 앱 시작 시 `SplashScreen` 표시
2. `_checkLoginStatus()` 호출
3. 로그인 상태 확인:
   - 로그인 상태가 아니면 → 로그인 화면으로 이동
   - 로그인 상태이면 → 토큰 유효성 검증
     - 토큰이 유효하면 → 홈 화면으로 이동
     - 토큰이 무효하면 → 로그인 화면으로 이동

### Navigator 사용법

- **pushReplacementNamed**: 현재 화면을 대체하며 이동
  - 이전 화면으로 돌아갈 수 없음
  - 로그인/로그아웃 시 사용

- **pushNamed**: 새 화면을 스택에 추가
  - 이전 화면으로 돌아갈 수 있음
  - 회원가입 화면 이동 시 사용

## ✅ 확인 사항
- [ ] `lib/main.dart` 파일이 올바르게 수정되었는지 확인
- [ ] 모든 화면이 라우트에 등록되었는지 확인
- [ ] 코드에 문법 오류가 없는지 확인

## 🔍 문제 해결

### 화면이 표시되지 않는 경우
- 라우트 이름이 정확한지 확인
- 화면 클래스가 올바르게 import되었는지 확인

### 로그인 상태 확인이 작동하지 않는 경우
- `AuthService.isLoggedIn()` 메서드 확인
- `SharedPreferences`가 제대로 작동하는지 확인

## 📚 다음 단계
다음 단계에서는 테스트 및 확인을 진행합니다.
→ [단계8: 테스트 및 확인](./단계8_테스트_및_확인.md)

